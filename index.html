<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Rosto com Ã¡udio (kids)</title>

<style>
:root{
--bg1:#071a2e;
--bg2:#02060c;
--face1:#12385a;
--face2:#0a1f33;
--iris1:#6ad0ff;
--iris2:#2ea9ff;
--glow: rgba(80,190,255,.35);
--btn1:#39c6ff;
--btn2:#2a8bff;
--btnText:#07121c;
--topPad:10px;
--sidePad:12px;
--frameMaxH:72vh;
}
*{box-sizing:border-box}
html,body{height:100%}

body{
margin:0;
min-height:100svh;
display:grid;
grid-template-rows:auto 1fr;
padding:
calc(env(safe-area-inset-top)+var(--topPad))
calc(env(safe-area-inset-right)+var(--sidePad))
calc(env(safe-area-inset-bottom)+14px)
calc(env(safe-area-inset-left)+var(--sidePad));
background:radial-gradient(1200px 700px at 50% 35%,var(--bg1),var(--bg2));
font-family:system-ui;
color:#cfeaff;
gap:12px;
}

.wrap{
width:min(560px,100%);
height:min(var(--frameMaxH),92vw);
aspect-ratio:1/1;
display:grid;
place-items:center;
position:relative;
justify-self:center;
}

.face{
width:100%;
height:100%;
border-radius:28px;
background:radial-gradient(900px 700px at 50% 15%,var(--face1),var(--face2));
box-shadow:0 24px 60px rgba(0,0,0,.55), inset 0 0 0 2px rgba(255,255,255,.05);
position:relative;
overflow:hidden;
}

.meter{
position:absolute;
top:14px;left:14px;right:14px;
height:8px;border-radius:999px;
background:rgba(255,255,255,.07);
overflow:hidden;border:1px solid rgba(255,255,255,.10);
}
.meter>div{height:100%;width:0;background:#7ce0ff;}

.eyes{
position:absolute;
top:22%;left:50%;
transform:translateX(-50%);
width:80%;
display:flex;
justify-content:space-between;
}

.eye{
width:36%;aspect-ratio:1/1;border-radius:999px;
background:radial-gradient(circle at 50% 55%,var(--iris1),var(--iris2));
box-shadow:0 0 40px var(--glow);
position:relative;
overflow:hidden;
}

.pupil{
position:absolute;
left:50%;top:56%;
transform:translate(-50%,-50%);
width:26%;height:26%;
border-radius:999px;
background:#000;
}

.lid{
position:absolute;inset:-2px;
background:#07121c;
transform:translateY(-110%);
border-radius:999px;
animation:blink 4.3s infinite;
}
@keyframes blink{
0%,92%,100%{transform:translateY(-110%)}
95%{transform:translateY(20%)}
}

.mouth-wrap{
position:absolute;
left:50%;bottom:18%;
transform:translateX(-50%);
width:34%;height:24%;
display:grid;place-items:center;
}

.mouth{
width:100%;height:52%;
border-radius:0 0 999px 999px;
background:#12070a;
overflow:hidden;
}

.micBtn{
position:absolute;
inset:0;
display:grid;
place-items:center;
}

.micBtn button{
border:none;
cursor:pointer;
padding:16px 20px;
border-radius:18px;
font-weight:800;
font-size:18px;
color:var(--btnText);
background:linear-gradient(135deg,var(--btn1),var(--btn2));
}

.robot-panel{
width:100%;
overflow:hidden;
border-radius:18px;
display:grid;
place-items:center;
}
.robot-panel img{
width:100%;
height:100%;
object-fit:contain;
}
</style>
</head>

<body>

<div class="wrap">
<div class="face">
<div class="meter"><div id="bar"></div></div>

<div class="eyes">
<div class="eye"><div class="pupil"></div><div class="lid"></div></div>
<div class="eye"><div class="pupil"></div><div class="lid"></div></div>
</div>

<div class="mouth-wrap">
<div class="mouth" id="mouth"></div>
</div>

<div class="micBtn">
<button id="startBtn">Ligar microfone</button>
</div>
</div>
</div>

<div class="robot-panel">
<img src="robo.jpg">
</div>

<script>
(()=>{
let audioCtx, analyser, data, stream;
let running=false;
let wakeLock=null;

const mouth=document.getElementById("mouth");
const bar=document.getElementById("bar");
const btn=document.getElementById("startBtn");

function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

async function enableFullscreen(){
try{
if(document.fullscreenEnabled)
await document.documentElement.requestFullscreen({navigationUI:"hide"});
}catch(e){}
}

async function requestWake(){
try{
if("wakeLock"in navigator)
wakeLock=await navigator.wakeLock.request("screen");
}catch(e){}
}

document.addEventListener("visibilitychange",()=>{
if(document.visibilityState==="visible"&&running)requestWake();
});

async function start(){
if(running)return;
running=true;

await enableFullscreen();
await requestWake();

const AC=window.AudioContext||window.webkitAudioContext;
audioCtx=new AC();

stream=await navigator.mediaDevices.getUserMedia({audio:true});
const source=audioCtx.createMediaStreamSource(stream);

analyser=audioCtx.createAnalyser();
analyser.fftSize=1024;
data=new Uint8Array(analyser.fftSize);
source.connect(analyser);

btn.style.display="none";
loop();
}

function rms(arr){
let s=0;
for(let i=0;i<arr.length;i++){
let n=(arr[i]-128)/128;
s+=n*n;
}
return Math.sqrt(s/arr.length);
}

function loop(){
if(!running)return;
analyser.getByteTimeDomainData(data);
let level=rms(data)*2;

bar.style.width=clamp(level*120,0,100)+"%";
mouth.style.height=clamp(50+level*90,50,140)+"%";

requestAnimationFrame(loop);
}

btn.addEventListener("click",start);
})();
</script>
</body>
</html>
